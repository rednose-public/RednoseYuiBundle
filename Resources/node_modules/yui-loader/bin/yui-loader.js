#!/usr/bin/env node

var nopt = require('nopt'),
    fs = require('fs'),
    YUI = require('yui').YUI,
    Y = YUI(),
    knownOpts = {
        'config': [String],
        'out'   : [String],
        'module': [String, Array]
    },
    shortHands = {},
    args = nopt(knownOpts, shortHands, process.argv, 2);

var json = fs.readFileSync(args.config, 'utf8');
var config = JSON.parse(json);

// Create the loader instance
var loader = new Y.Loader(config);

loader.require(args.module);

// Resolve theses file (passing true calculates the dependencies for you)
var out = loader.resolve(true);

var str = [];
var first = true;

// Now walk the list of resolved files
out.js.forEach(function(file) {
    // Skip the YUI seed file, it should be loaded separately.
    if (first === false) {
        str.push(fs.readFileSync(file, 'utf8'));
    } else {
        first = false;
    }
});

// Write all the files out into a single file
fs.writeFileSync(args.out, str.join('\n'), 'utf8');
